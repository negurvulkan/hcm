# Startnummern-Regelsystem / Start Number Rules System

## Deutsch

### Überblick
Das Startnummern-Regelsystem steuert, wie Startnummern für Starter, Pferde und Prüfungen vergeben, formatiert und verwaltet werden. Die Regeln werden in JSON-Dateien (z. B. `docs/start_number_rules_classic.json`) hinterlegt und können turnierweit oder klassenspezifisch gelten. Jede Regel beschreibt Sequenzen, Formatierungen, Vergabezeitpunkte, Einschränkungen und optionale Sonderfälle.

### Sequenzdefinition (`sequence`)
- `start`: erste Startnummer, die aus der Sequenz generiert wird.
- `step`: Abstand zwischen zwei Startnummern.
- `range`: erlaubter Wertebereich `[min, max]`; außerhalb dieses Bereichs wird keine Nummer vergeben.
- `reset`: bestimmt, wann die Sequenz zurückgesetzt wird (`per_day`, `per_class`, `never`).

### Formatierung (`format`)
- `prefix`/`suffix`: alphanumerische Zusätze vor bzw. nach der Nummer.
- `width`: Mindestanzahl an Ziffern; falls nötig, erfolgt eine Nullauffüllung.
- `separator`: Trennzeichen zwischen Formatteilen (z. B. Bindestrich oder Leerzeichen).

### Vergabeparameter (`allocation`)
- `entity`: beschreibt, auf welches Objekt die Nummer gemappt wird (`start`, `horse`, `rider`).
- `time`: legt fest, wann die Nummer vergeben wird (`on_entry`, `on_startlist`, `on_checkin`).
- `reuse`: definiert, wann Nummern nach Abmeldungen wieder freigegeben werden (`never`, `after_scratch`).
- `lock_after`: Zeitpunkt, zu dem eine Nummer nicht mehr verändert werden darf (z. B. `start_called`).

### Einschränkungen (`constraints`)
- `unique_per`: legt den Kontext der Eindeutigkeit fest (`tournament`, `class`, `day`).
- `blocklists`: Array verbotener Nummern (z. B. `"13"`).
- `club_spacing`: Mindestanzahl anderer Starter zwischen zwei Teilnehmern desselben Vereins.
- `horse_cooldown_min`: Mindestabstand in Minuten, bevor dasselbe Pferd erneut startet.

### Sonderregeln (`overrides`)
Overrides werden in der angegebenen Reihenfolge geprüft. Jede Regel enthält einen `if`-Block als Bedingung (z. B. nach Division, Datum oder Prüfung) und überschreibt bei Treffern Teile der Sequenz- oder Formatdefinition. Sobald eine Bedingung erfüllt ist, werden die überschriebenen Werte für den jeweiligen Start angewandt.

### Pflege und Tests
1. Regeln als valide JSON-Datei speichern und vor dem Einspielen mit einem Linter prüfen.
2. Änderungen in einer Staging-Instanz testen, insbesondere bei komplexen Overrides.
3. Nach Anpassungen Startlisten neu generieren oder betroffene Klassen aktualisieren.
4. Anpassungen dokumentieren, um sie bei zukünftigen Turnieren wiederverwenden zu können.

## English

### Overview
The start number rule system controls how start numbers are assigned, formatted, and managed for riders, horses, and classes. Rules are stored in JSON files (e.g., `docs/start_number_rules_classic.json`) and can apply at tournament or class level. Each rule describes sequences, formatting, allocation timing, constraints, and optional special cases.

### Sequence Definition (`sequence`)
- `start`: first start number generated by the sequence.
- `step`: increment between two start numbers.
- `range`: allowed value range `[min, max]`; numbers outside the range are not issued.
- `reset`: defines when the sequence restarts (`per_day`, `per_class`, `never`).

### Formatting (`format`)
- `prefix`/`suffix`: alphanumeric add-ons placed before or after the number.
- `width`: minimum number of digits; zero padding is applied if required.
- `separator`: delimiter between formatting parts (e.g., dash or space).

### Allocation Parameters (`allocation`)
- `entity`: indicates which object receives the number (`start`, `horse`, `rider`).
- `time`: determines when the number is assigned (`on_entry`, `on_startlist`, `on_checkin`).
- `reuse`: defines if and when numbers become available again after scratches (`never`, `after_scratch`).
- `lock_after`: point in time after which the number must not change (e.g., `start_called`).

### Constraints (`constraints`)
- `unique_per`: defines the uniqueness scope (`tournament`, `class`, `day`).
- `blocklists`: array of banned numbers (e.g., `"13"`).
- `club_spacing`: minimum number of other starters between riders of the same club.
- `horse_cooldown_min`: minimum cooldown in minutes before the same horse may enter again.

### Special Rules (`overrides`)
Overrides are evaluated in the order listed. Each rule contains an `if` block as a condition (e.g., by division, date, or class) and overrides parts of the sequence or formatting definition when matched. Once a condition is met, the overridden values apply to that start.

### Maintenance and Testing
1. Save rules as valid JSON and lint them before deployment.
2. Test changes on a staging instance, especially when complex overrides are involved.
3. Regenerate start lists or refresh affected classes after updates.
4. Document adjustments so they can be reused for future tournaments.
